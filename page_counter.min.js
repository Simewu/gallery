let siteData={};async function fetchAndUpdateCounter(e){try{const t="http://simewu-simple-",a="count.simewu.repl.co/",o=await fetch(`${t}${a}${e}.json`);siteData=await o.json(),document.getElementById("counter").textContent=siteData.total,document.getElementById("modalPageName").textContent=e.charAt(0).toUpperCase()+e.slice(1),setupModalListener()}catch(e){console.error("Error fetching counter:",e),document.getElementById("counter").style.display="none"}}function setupModalListener(){var e=document.getElementById("visitorModal");e&&e.addEventListener("show.bs.modal",(function(){google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback((()=>drawChart(siteData.total,siteData.daily,document.getElementById("modalPageName").textContent)))}))}function drawChart(e,t,a){var o=new google.visualization.DataTable;o.addColumn("string","Day"),o.addColumn("number","Visitors");let n=new Array(12).fill(0).map((()=>[])),l=!1;t.forEach(((e,a)=>{let o=new Date;o.setDate(o.getDate()-(t.length-1-a));let d=o.getMonth();n[d].push({date:o,count:e}),d===(new Date).getMonth()&&e>0&&(l=!0)}));let d=[];n.forEach(((e,t)=>{(e.some((e=>e.count>0))||!l&&t===(new Date).getMonth())&&(e.forEach((e=>{let t=e.date.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});d.push([t,e.count])})),l=!0)})),o.addRows(d);var r={width:800,height:400,lineWidth:5,colors:[textColorDim],hAxis:{titleTextStyle:{color:textColor},textStyle:{color:textColorDim},slantedText:!0,slantedTextAngle:45},vAxis:{title:"Number of Visitors",titleTextStyle:{color:textColor},textStyle:{color:textColorDim}},backgroundColor:bgColor,legend:"none"};new google.visualization.LineChart(document.getElementById("visitorGraphModal")).draw(o,r),document.getElementById("totalCount").innerHTML=`Total number of visitors for ${a}: <span class='text-color'>${e}</span>`;let i=t.reduce(((e,t)=>e+t),0);i==e?document.getElementById("yearlyCount").display="none":document.getElementById("yearlyCount").innerHTML=`Number of visitors in the past 365 Days: <span class='text-color'>${i}</span>`}function counter_init(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-LGHB6S47PK");var t=document.querySelector("footer");if(null===t)return;var a=document.createElement("div");a.className="col-auto";var o=document.createElement("span");o.id="counter",o.className="badge badge-pill float-right text-color-dim",o.setAttribute("data-bs-toggle","modal"),o.setAttribute("data-bs-target","#visitorModal"),a.appendChild(o);var n=t.querySelector(".row");n&&n.appendChild(a);var l=document.createElement("div");l.className="modal fade",l.id="visitorModal",l.setAttribute("aria-labelledby","visitorModalLabel"),l.setAttribute("aria-hidden","true");var d=document.createElement("div");d.className="modal-dialog modal-lg",l.appendChild(d);var r=document.createElement("div");r.className="modal-content bg-color-dimmer modal-lg",d.appendChild(r);var i=document.createElement("div");i.className="modal-header",r.appendChild(i);var s=document.createElement("h5");s.className="modal-title",s.id="visitorModalLabel",s.innerHTML='Counter for <b><span id="modalPageName" class="text-color"></span></b>',i.appendChild(s);var c=document.createElement("button");c.type="button",c.className="btn-close bg-color-inv",c.setAttribute("data-bs-dismiss","modal"),c.setAttribute("aria-label","Close"),i.appendChild(c);var m=document.createElement("div");m.className="modal-body p-2",r.appendChild(m);var u=document.createElement("div");u.id="totalCount",m.appendChild(u);var p=document.createElement("div");p.id="visitorGraphModal",m.appendChild(p);var h=document.createElement("div");h.id="yearlyCount",m.appendChild(h),t.appendChild(l);let g=location.href.split("/")[location.href.split("/").length-1].toLowerCase();""===g&&(g="index");["index","projects","publications","gallery","resume","contact","submitted"].includes(g)?fetchAndUpdateCounter(g):document.getElementById("counter").display="none"}setTimeout(counter_init,10);